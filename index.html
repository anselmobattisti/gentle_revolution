<html>

<style type="text/css">
    html,
    body {
        height: 100%;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        /* Centraliza horizontalmente */
        align-items: center;
        /* Centraliza verticalmente */
    }

    #config {
        background-color: #e5e5e5;
        margin: 10;
        padding: 10;
        border-radius: 5%;
        border: 2px solid #333;
    }

    p {
        font-weight: bold;
        margin: 0;
        padding: 0;
        padding-bottom: 10px;
    }
</style>

<body onload="document.getElementById('btnstart').focus()">
    <div id="mostrar" style="display: none;">
        <canvas id="myCanvas" width="800" height="800"></canvas>

        <p id="natela"></p>
        <p>
            <input type="button" onClick="window.location.reload(true);" value="Restart" />
        </p>
    </div>

    <div id="config">
        <p>
            Kind:<br />
            <input type="checkbox" id="mul" value="*" checked>*
            <input type="checkbox" id="sub" value="-" checked>-
            <input type="checkbox" id="soma" value="+" checked>+
            <input type="checkbox" id="div" value="/" checked>/
        </p>
        <p>
            Max Operation Value:</br>
            <input type="text" name="limite" id="limite" value="40" />
        </p>

        <p>
            Num Operation:</br>
            <input type="text" name="numop" id="numop" value="10" />
        </p>        

        <p>
            <input type="button" onClick="gerarOperaces()" value="Random Generation" />
        </p>
        <p>
            Arithmetic Operations:<br />
            <textarea rows="10" id="operacoes"></textarea><br />
        </p>
        <hr />
        <p>
            Delay:</br>
            <input type="text" name="delay" id="delay" value="2" />
        </p>
        <p>
            <input type="button" id="btnstart" onClick="iniciar()" value="Start" />
        </p>
    </div>


    <script>
        function drawBalls(numberOfBalls) {
            const canvas = document.getElementById('myCanvas');

            canvas.width = window.innerWidth * 0.90;
            canvas.height = window.innerHeight * 0.90;
            canvas.style.align = "center";

            const ctx = canvas.getContext('2d');
            const ballRadius = 25; // Metade de 50px
            let balls = [];
            clearCanvas();

            function isSpaceOccupied(x, y) {
                return balls.some(ball => {
                    const dx = ball.x - x;
                    const dy = ball.y - y;
                    return Math.sqrt(dx * dx + dy * dy) < ballRadius * 2;
                });
            }

            function drawBall(x, y) {
                ctx.beginPath();
                ctx.arc(x, y, ballRadius, 0, Math.PI * 2);
                ctx.fillStyle = 'red';
                ctx.fill();
                ctx.closePath();
            }

            for (let i = 0; i < numberOfBalls; i++) {
                let x, y, collision;
                do {
                    x = Math.random() * ((canvas.width - 20) - ballRadius * 2) + (ballRadius + 20);
                    y = Math.random() * ((canvas.height - 20) - ballRadius * 2) + (ballRadius + 20);
                    collision = isSpaceOccupied(x, y);
                } while (collision);

                drawBall(x, y);
                balls.push({ x, y });
            }
        }

        function generateMathOperation() {
            const maxResult = parseInt(document.getElementById("limite").value);

            max_num = maxResult * 2

            let num1, num2, operation, result;

            const operations = [];

            if (document.getElementById("soma").checked) {
                operations.push("+");
            }

            if (document.getElementById("sub").checked) {
                operations.push("-");
            }

            if (document.getElementById("mul").checked) {
                operations.push("*");
                if (num2 == 0) {
                            num2 = 1;
                        } }

            if (document.getElementById("div").checked) {
                operations.push("/");
            }

            do {
                num1 = Math.floor(Math.random() * max_num); // Números de 0 a 40
                num2 = Math.floor(Math.random() * max_num); // Números de 0 a 40

                operation = operations[Math.floor(Math.random() * operations.length)];
                symbol = "";
                switch (operation) {
                    case '+':
                        result = num1 + num2;
                        symbol = "+";
                        break;
                    case '-':
                        result = num1 - num2;
                        symbol = "-";
                        break;
                    case '*':
                        result = num1 * num2;
                        symbol = "*";
                        break;
                    case '/':
                        if (num2 == 0) {
                            num2 = 1;
                        }
                        result = num1 * num2;
                        symbol = "/";
                        break;
                }
            } while (result > maxResult || result < 0);

            return `${num1} ${symbol} ${num2} = ${result}`;
        }

        function gerarOperaces() {
            let resultado = ""

            numop = document.getElementById("numop").value

            for (let i = 0; i < numop; i++) {
                resultado += generateMathOperation()
                if (i < (numop-1)) {
                    resultado += "\n";
                }
            }
            document.getElementById("operacoes").innerHTML = resultado

        }

        function clearCanvas() {
            const canvas = document.getElementById('myCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function drawText(text) {
            clearCanvas();
            const canvas = document.getElementById('myCanvas');
            const ctx = canvas.getContext('2d');

            ctx.font = '80px Arial'; // Define o tamanho e o tipo da fonte
            ctx.fillStyle = 'red'; // Define a cor do texto
            // Centraliza o texto no canvas
            const textWidth = ctx.measureText(text).width;
            const x = (canvas.width - textWidth) / 2;
            const y = canvas.height / 2;
            ctx.fillText(text, x, y); // Escreve o texto no canvas
        }

        async function iniciar() {
            document.getElementById("config").style.display = "none";
            document.getElementById("mostrar").style.display = "block";
            clearCanvas();
            natela = document.getElementById("natela")
            delay = parseInt(document.getElementById("delay").value) * 1000
            const regex = /(\d+)\s*([+*-])\s*(\d+)\s*=\s*(\d+)/;
            const textarea = document.getElementById('operacoes');
            const lines = textarea.value.split('\n');

            for (let i = 0; i < lines.length; i++) {

                let match = lines[i].match(regex);

                if (match) {
                    const num1 = match[1];
                    const operator = match[2];
                    const num2 = match[3];
                    const resultado = match[4];

                    clearCanvas();
                    await sleep(500);

                    natela.innerHTML = num1;
                    drawBalls(num1);
                    await sleep(delay);

                    natela.innerHTML = operator;
                    drawText(operator);
                    await sleep(delay);
                    natela.innerHTML = num2;
                    drawBalls(num2);
                    await sleep(delay);
                    natela.innerHTML = "=";
                    drawText("=");
                    await sleep(delay);
                    natela.innerHTML = resultado;
                    drawBalls(resultado);
                    await sleep(delay);
                    natela.innerHTML = "";

                    console.log(`Número 1: ${num1}, Operador: ${operator}, Número 2: ${num2}`);
                } else {
                    console.log("Nenhum padrão correspondente encontrado.");
                }
            }
        }
        gerarOperaces();
    </script>
</body>

</html>