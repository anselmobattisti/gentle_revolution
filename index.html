<html>

<style type="text/css">
    html,
    body {
        height: 100%;
        margin: 0px;
        padding: 0px;
        display: flex;
        justify-content: center;
        /* Centraliza horizontalmente */
        align-items: center;
        /* Centraliza verticalmente */
        font-size: 18px;
    }

    #myCanvas {
        margin-top: 20px;
        border: 2px solid black;
    }

    #config {
        background-color: #e5e5e5;
        margin: 10;
        padding: 10;
        border-radius: 5%;
        border: 2px solid #333;
    }

    p {
        font-weight: bold;
        margin: 0;
        padding: 0;
        padding-bottom: 10px;
    }

    #natela {
        color: #b5b5b5;
        width: 100%;
        text-align: center;
    }

    input[type=button] {
        font-size: 18px;
        text-align: center;
        width: 100%;
        padding: 10px;
    }

    input[type=number] {
        font-size: 18px;
        text-align: center;
        width: 100%;
        padding: 5px;
    }
</style>

<body onload="document.getElementById('btnstart').focus()">
    <div id="mostrar" style="display: none;">
        <canvas id="myCanvas"></canvas>

        <p id="natela">.</p>
        <p>
            <input type="button" id="back" onClick="window.location.reload(true);" value="Back" />
        </p>
    </div>

    <div id="config">
        <p>
            Operations Type:<br />
            <label onclick="disableNum()">
                <input type="checkbox" id="mul" value="*" checked>*
            </label>

            <label onclick="disableNum()">
                <input type="checkbox" id="sub" value="-" checked>-
            </label>

            <label onclick="disableNum()">
                <input type="checkbox" id="soma" value="+" checked>+
            </label>

            <label onclick="disableNum()">
                <input type="checkbox" id="div" value="/" checked>/
            </label>

            <label onclick="disableOps()">
                <input type="checkbox" id="num" value="n">Numbers
            </label>
        </p>
        <p>
            Max Operation Value:</br>
            <input type="number" name="limite" id="limite" value="20" />
        </p>

        <p>
            Num Operations:</br>
            <input type="number" name="numop" id="numop" value="5" />
        </p>

        <p>
            <input type="button" onClick="gerarOperaces()" value="Random Generation" />
        </p>
        <p>
            Arithmetic Operations:<br />
            <textarea rows="10" id="operacoes"></textarea><br />
        </p>
        <hr />
        <p>
            Delay:</br>
            <input type="number" name="delay" id="delay" value="2" />
        </p>
        <p>
            <input type="button" id="btnstart" onClick="iniciar()" value="Start"
                style="background-color: greenyellow;" />
        </p>
    </div>


    <script>

        function disableNum() {
            document.getElementById("num").checked = false
        }

        function disableOps() {
            document.getElementById("mul").checked = false
            document.getElementById("sub").checked = false
            document.getElementById("div").checked = false
            document.getElementById("soma").checked = false
            gerarOperaces()
        }

        function drawBalls(numberOfBalls) {
            const canvas = document.getElementById('myCanvas');
            const ctx = canvas.getContext('2d');
            const ballRadius = 25; // Metade de 50px
            let balls = [];
            clearCanvas();

            function isSpaceOccupied(x, y) {
                return balls.some(ball => {
                    const dx = ball.x - x;
                    const dy = ball.y - y;
                    return Math.sqrt(dx * dx + dy * dy) < ballRadius * 2;
                });
            }

            function drawBall(x, y) {
                ctx.beginPath();
                ctx.arc(x, y, ballRadius, 0, Math.PI * 2);
                ctx.fillStyle = 'red';
                ctx.fill();
                ctx.closePath();
            }

            for (let i = 0; i < numberOfBalls; i++) {
                let x, y, collision;
                do {
                    x = Math.random() * ((canvas.width - 20) - ballRadius * 2) + (ballRadius + 20);
                    y = Math.random() * ((canvas.height - 20) - ballRadius * 2) + (ballRadius + 20);
                    collision = isSpaceOccupied(x, y);
                } while (collision);

                drawBall(x, y);
                balls.push({ x, y });
            }
        }

        function generateMathOperation() {
            const maxResult = parseInt(document.getElementById("limite").value);

            max_num = maxResult * 2

            let num1, num2, operation, result;

            const operations = [];

            if (document.getElementById("soma").checked) {
                operations.push("+");
            }

            if (document.getElementById("sub").checked) {
                operations.push("-");
            }

            if (document.getElementById("mul").checked) {
                operations.push("*");
                if (num2 == 0) {
                    num2 = 1;
                }
            }

            if (document.getElementById("div").checked) {
                operations.push("/");
            }

            do {
                num1 = Math.floor(Math.random() * max_num); // Números de 0 a 40
                num2 = Math.floor(Math.random() * max_num); // Números de 0 a 40

                operation = operations[Math.floor(Math.random() * operations.length)];
                symbol = "";
                switch (operation) {
                    case '+':
                        result = num1 + num2;
                        symbol = "+";
                        break;
                    case '-':

                        if (num1 < num2) {
                            aux = num1
                            num1 = num2
                            num2 = aux
                        }

                        result = num1 - num2;
                        symbol = "-";
                        break;
                    case '*':
                        result = num1 * num2;
                        symbol = "*";
                        break;
                    case '/':
                        if (num2 == 0) {
                            num2 = 1;
                        }
                        result = num1 * num2;
                        symbol = "/";
                        break;
                }
            } while (result > maxResult || result < 0);

            return `${num1} ${symbol} ${num2} = ${result}`;
        }

        function gerarOperaces() {
            let resultado = ""

            numop = document.getElementById("numop").value

            const maxResult = parseInt(document.getElementById("limite").value);

            for (let i = 0; i < numop; i++) {
                if (document.getElementById("num").checked == true) {
                    resultado += Math.floor(Math.random() * maxResult);
                } else {
                    resultado += generateMathOperation()
                }

                if (i < (numop - 1)) {
                    resultado += "\n";
                }
            }
            document.getElementById("operacoes").innerHTML = resultado

        }

        function clearCanvas() {
            const canvas = document.getElementById('myCanvas');
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        function drawText(text) {
            clearCanvas();
            const canvas = document.getElementById('myCanvas');
            const ctx = canvas.getContext('2d');

            ctx.font = '80px Arial'; // Define o tamanho e o tipo da fonte
            ctx.fillStyle = 'red'; // Define a cor do texto
            // Centraliza o texto no canvas
            const textWidth = ctx.measureText(text).width;
            const x = (canvas.width - textWidth) / 2;
            const y = canvas.height / 2;
            ctx.fillText(text, x, y); // Escreve o texto no canvas
        }

        async function iniciar() {
            toggleFullScreen();

            const canvas = document.getElementById('myCanvas');
            canvas.width = window.innerWidth * 0.90;
            canvas.height = window.innerHeight * 0.90;
            canvas.style.align = "center";

            document.getElementById("config").style.display = "none";
            document.getElementById("mostrar").style.display = "block";
            clearCanvas();
            natela = document.getElementById("natela")
            delay = parseInt(document.getElementById("delay").value) * 1000

            document.getElementById("back").focus()

            const regex = /(\d+)\s*([+*-])\s*(\d+)\s*=\s*(\d+)/;
            const textarea = document.getElementById('operacoes');
            const lines = textarea.value.split('\n');

            for (let i = 0; i < lines.length; i++) {

                let match = lines[i].match(regex);

                if (match) {
                    const num1 = match[1];
                    const operator = match[2];
                    const num2 = match[3];
                    const resultado = match[4];

                    clearCanvas();
                    await sleep(1000);

                    natela.innerHTML = num1;
                    drawBalls(num1);
                    await sleep(delay);

                    natela.innerHTML = operator;
                    drawText(operator);
                    await sleep(delay);
                    natela.innerHTML = num2;
                    drawBalls(num2);
                    await sleep(delay);
                    natela.innerHTML = "=";
                    drawText("=");
                    await sleep(delay);
                    natela.innerHTML = resultado;
                    drawBalls(resultado);
                    await sleep(delay);
                    natela.innerHTML = ".";

                    console.log(`Número 1: ${num1}, Operador: ${operator}, Número 2: ${num2}`);
                } else {
                    const regex = /(\d+)/;
                    let match2 = lines[i].match(regex);
                    if (match2) {
                        natela.innerHTML = match2[1];
                        drawBalls(match2[1]);
                        await sleep(delay);
                        clearCanvas();
                        natela.innerHTML = " - ";
                        await sleep(delay);
                    } else {
                        console.log("Nenhum padrão correspondente encontrado.");
                    }
                }
            }
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                // Solicita que o documento entre em tela cheia
                if (document.documentElement.requestFullscreen) {
                    document.documentElement.requestFullscreen();
                } else if (document.documentElement.mozRequestFullScreen) { /* Firefox */
                    document.documentElement.mozRequestFullScreen();
                } else if (document.documentElement.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
                    document.documentElement.webkitRequestFullscreen();
                } else if (document.documentElement.msRequestFullscreen) { /* IE/Edge */
                    document.documentElement.msRequestFullscreen();
                }
            } else {
                // Sai do modo tela cheia
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.mozCancelFullScreen) { /* Firefox */
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) { /* Chrome, Safari & Opera */
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) { /* IE/Edge */
                    document.msExitFullscreen();
                }
            }
        }
        gerarOperaces();
    </script>
</body>

</html>